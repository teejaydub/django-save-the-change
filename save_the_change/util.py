# -*- coding: utf-8 -*-

from __future__ import division, absolute_import, print_function, unicode_literals

from datetime import date, time, datetime, timedelta, tzinfo
from decimal import Decimal
from uuid import UUID


#: A :class:`set` listing known immutable types.
IMMUTABLE_TYPES = set((
	type(None), bool, float, complex, Decimal,
	str, bytes, tuple, frozenset,
	date, time, datetime, timedelta, tzinfo,
	UUID, int))

#: A :class:`set` listing known immutable types that are infinitely
#: recursively iterable.
INFINITELY_ITERABLE_IMMUTABLE_TYPES = set((str, bytes))


class DoesNotExist:
	"""Indicates when an attribute does not exist on an object."""
	pass


def is_mutable(obj):
	"""
	Checks if given object is likely mutable.
	
	:param obj: object to check.
	
	We check that the object is itself a known immutable type, and then attempt
	to recursively check any objects within it. Strings are special cased to
	prevent us getting stuck in an infinite loop.
	
	:return:
		:const:`True` if the object is likely mutable, :const:`False` if it
		definitely is not.
	:rtype: :obj:`bool`
	
	"""
	
	if type(obj) not in IMMUTABLE_TYPES:
		return True
	
	elif type(obj) not in INFINITELY_ITERABLE_IMMUTABLE_TYPES:
		try:
			for sub_obj in iter(obj):
				if is_mutable(sub_obj):
					return True
		
		except TypeError:
			pass
	
	return False
